{"content":"# DSC Configurations\n\n>Applies To: Windows PowerShell 4.0, Windows PowerShell 5.0\n\nDSC configurations are PowerShell scripts that define a special type of function. \nTo define a configuration, you use the PowerShell keyword __Configuration__.\n\n```powershell\nConfiguration MyDscConfiguration {\n\n    Node “TEST-PC1” {\n        WindowsFeature MyFeatureInstance {\n            Ensure = “Present”\n            Name =  “RSAT”\n        }\n        WindowsFeature My2ndFeatureInstance {\n            Ensure = “Present”\n            Name = “Bitlocker”\n        }\n    }\n}\n```\n\nSave the script as a .ps1 file.\n\n## Configuration syntax\n\nA configuration script consists of the following parts:\n\n- The **Configuration** block. This is the outermost script block. You define it by using the **Configuration** keyword and providing a name. In this case, the name of the configuration is \"MyDscConfiguration\".\n- One or more **Node** blocks. These define the nodes (computers or VMs) that you are configuring. In the above configuration, there is one **Node** block that targets a computer named \"TEST-PC1\".\n- One or more resource blocks. This is where the configuration sets the properties for the resources that it is configuring. In this case, there are two resource blocks, each of which call the \"WindowsFeature\" resource.\n\nWithin a **Configuration** block, you can do anything that you normally could in a PoweShell function. For example, in the previous example, if you didn't want to hard code the name of the target computer in the configuration, you could add a parameter for the node name:\n\n```powershell\nConfiguration MyDscConfiguration {\n\n    param(\n        [string[]]$computerName=\"localhost\"\n    )\n    Node $computerName {\n        WindowsFeature MyFeatureInstance {\n            Ensure = “Present”\n            Name =  “RSAT”\n        }\n        WindowsFeature My2ndFeatureInstance {\n            Ensure = “Present”\n            Name = “Bitlocker”\n        }\n    }\n}\n```\n\nIn this example, you specify the name of the node by passing it as the $computerName parameter when you [compile the configuraton](# Compiling the configuration). The name defaults to \"localhost\".\n\n## Compiling the configuration\nBefore you can enact a configuration, you have to compile it into a MOF document. You do this by calling the configuration like you would a PowerShell function.\n>__Note:__ To call a configuration, the function must be in global scope (as with any other PowerShell function). You can make this happen either by \"dot-sourcing\" the script, or by running the configuration script by using F5 or clicking on the __Run Script__ button in the ISE. To dot-source the script, run the command `. .\\myConfig.ps1` where `myConfig.ps1` is the name of the script file that contains your configuration.\n\nWhen you call the configuration, it creates:\n\n- A folder in the current directory with the same name as the configuration.\n- A file named _NodeName_.mof in the new directory, where _NodeName_ is the name of the target node of the configuration. If there are more than one nodes, a MOF file will be created for each node.\n\n>__Note__: The MOF file contains all of the configuration information for the target node. Because of this, it’s important to keep it secure. For more information, see [Securing the MOF file](secureMOF.md).\n\nCompiling the first configuration above results in the following folder structure:\n\n```powershell\nPS C:\\users\\default\\Documents\\DSC Configurations> . .\\MyDscConfiguration.ps1\nPS C:\\users\\default\\Documents\\DSC Configurations> MyDscConfiguration\n    Directory: C:\\users\\default\\Documents\\DSC Configurations\\MyDscConfiguration\nMode                LastWriteTime         Length Name                                                                                              \n----                -------------         ------ ----                                                                                         \n-a----       10/23/2015   4:32 PM           2842 TEST-PC1.mof\n```  \n\nIf the configuration takes a parameter, as in the second example, that has to be provided at compile time. Here's how that would look:\n\n```powershell\nPS C:\\users\\default\\Documents\\DSC Configurations> . .\\MyDscConfiguration.ps1\nPS C:\\users\\default\\Documents\\DSC Configurations> MyDscConfiguration -computerName 'MyTestNode'\n    Directory: C:\\users\\default\\Documents\\DSC Configurations\\MyDscConfiguration\nMode                LastWriteTime         Length Name                                                                                              \n----                -------------         ------ ----                                                                                         \n-a----       10/23/2015   4:32 PM           2842 MyTestNode.mof\n```      \n\n## Using DependsOn\nA useful DSC keyword is __DependsOn__. Typically (though not necessarily always), DSC applies the resources in the order that they appear within the configuration. However, __DependsOn__ specifies which resources depend on other resources, and the LCM ensures that they are applied in the correct order, regardless of the order in which resource instances are defined. For example, a configuration might specify that an instance of the __User__ resource depends on the existence of a __Group__ instance:\n\n```powershell\nConfiguration DependsOnExample {\n    Node Test-PC1 {\n        Group GroupExample {\n            Ensure = “Present”\n            GroupName = “TestGroup”\n        }\nUser UserExample {\nEnsure = “Present”\nFullName = “TestUser”\nDependsOn = “GroupExample”\n}\n    }\n}\n```\n\n## Using New Resources in Your Configuration\nIf you ran the previous examples, you might have noticed that you were warned that you were using a resource without explicitly importing it.\nToday, DSC ships with 12 resources as part of the PSDesiredStateConfiguration module. Other resources in external modules must be placed in `$env:PSModulePath` in order to be recognized by the LCM. A new cmdlet, [Get-DscResource](https://technet.microsoft.com/en-us/library/dn521625.aspx), can be used to determine what resources are installed on the system and available for use by the LCM. \nOnce these modules have been placed in `$env:PSModulePath` and are properly recognized by [Get-DscResource](https://technet.microsoft.com/en-us/library/dn521625.aspx), they still need to be loaded within your configuration. __Import-DscResource__ is a dynamic keyword that can only be recognized within a __Configuration__ block (i.e. it is not a cmdlet). __Import-DscResource__ supports two parameters:\n* __ModuleName__ is the recommended way of using __Import-DscResource__. It accepts the name of the module that contains the resources to be imported (as well as a string array of module names). \n* __Name__ is the name of the resource to import. This is not the friendly name returned as “Name” by [Get-DscResource](https://technet.microsoft.com/en-us/library/dn521625.aspx), but the class name used when defining the resource schema (returned as __ResourceType__ by [Get-DscResource](https://technet.microsoft.com/en-us/library/dn521625.aspx)). \n\n## See Also\n* [Windows PowerShell Desired State Configuration Overview](overview.md)\n* [DSC Resources](resources.md)\n* [Configuring The Local Configuration Manager](metaconfig.md)","nodes":[{"content":"DSC Configurations","pos":[2,20]},{"content":"Applies To: Windows PowerShell 4.0, Windows PowerShell 5.0","pos":[23,81]},{"content":"DSC configurations are PowerShell scripts that define a special type of function.","pos":[83,164]},{"content":"To define a configuration, you use the PowerShell keyword <bpt id=\"p1\">__</bpt>Configuration<ept id=\"p1\">__</ept>.","pos":[165,242],"source":" \nTo define a configuration, you use the PowerShell keyword __Configuration__."},{"content":"Save the script as a .ps1 file.","pos":[558,589]},{"content":"Configuration syntax","pos":[594,614]},{"content":"A configuration script consists of the following parts:","pos":[616,671]},{"content":"The <bpt id=\"p1\">**</bpt>Configuration<ept id=\"p1\">**</ept> block.","pos":[675,703],"source":"The **Configuration** block."},{"content":"This is the outermost script block.","pos":[704,739]},{"content":"You define it by using the <bpt id=\"p1\">**</bpt>Configuration<ept id=\"p1\">**</ept> keyword and providing a name.","pos":[740,814],"source":" You define it by using the **Configuration** keyword and providing a name."},{"content":"In this case, the name of the configuration is \"MyDscConfiguration\".","pos":[815,883]},{"content":"One or more <bpt id=\"p1\">**</bpt>Node<ept id=\"p1\">**</ept> blocks.","pos":[886,914],"source":"One or more **Node** blocks."},{"content":"These define the nodes (computers or VMs) that you are configuring.","pos":[915,982]},{"content":"In the above configuration, there is one <bpt id=\"p1\">**</bpt>Node<ept id=\"p1\">**</ept> block that targets a computer named \"TEST-PC1\".","pos":[983,1080],"source":" In the above configuration, there is one **Node** block that targets a computer named \"TEST-PC1\"."},{"content":"One or more resource blocks.","pos":[1083,1111]},{"content":"This is where the configuration sets the properties for the resources that it is configuring.","pos":[1112,1205]},{"content":"In this case, there are two resource blocks, each of which call the \"WindowsFeature\" resource.","pos":[1206,1300]},{"content":"Within a <bpt id=\"p1\">**</bpt>Configuration<ept id=\"p1\">**</ept> block, you can do anything that you normally could in a PoweShell function.","pos":[1302,1404],"source":"Within a **Configuration** block, you can do anything that you normally could in a PoweShell function."},{"content":"For example, in the previous example, if you didn't want to hard code the name of the target computer in the configuration, you could add a parameter for the node name:","pos":[1405,1573]},{"content":"In this example, you specify the name of the node by passing it as the $computerName parameter when you <bpt id=\"p1\">[</bpt>compile the configuraton<ept id=\"p1\">](# Compiling the configuration)</ept>.","pos":[1953,2115],"source":"In this example, you specify the name of the node by passing it as the $computerName parameter when you [compile the configuraton](# Compiling the configuration)."},{"content":"The name defaults to \"localhost\".","pos":[2116,2149]},{"content":"Compiling the configuration","pos":[2154,2181]},{"content":"Before you can enact a configuration, you have to compile it into a MOF document.","pos":[2182,2263]},{"content":"You do this by calling the configuration like you would a PowerShell function.","pos":[2264,2342]},{"content":"<bpt id=\"p1\">__</bpt>Note:<ept id=\"p1\">__</ept> To call a configuration, the function must be in global scope (as with any other PowerShell function).","pos":[2344,2456],"source":"__Note:__ To call a configuration, the function must be in global scope (as with any other PowerShell function)."},{"content":"You can make this happen either by \"dot-sourcing\" the script, or by running the configuration script by using F5 or clicking on the <bpt id=\"p1\">__</bpt>Run Script<ept id=\"p1\">__</ept> button in the ISE.","pos":[2457,2622],"source":" You can make this happen either by \"dot-sourcing\" the script, or by running the configuration script by using F5 or clicking on the __Run Script__ button in the ISE."},{"content":"To dot-source the script, run the command <ph id=\"ph1\">`. .\\myConfig.ps1`</ph> where <ph id=\"ph2\">`myConfig.ps1`</ph> is the name of the script file that contains your configuration.","pos":[2623,2769],"source":" To dot-source the script, run the command `. .\\myConfig.ps1` where `myConfig.ps1` is the name of the script file that contains your configuration."},{"content":"When you call the configuration, it creates:","pos":[2771,2815]},{"content":"A folder in the current directory with the same name as the configuration.","pos":[2819,2893]},{"content":"A file named <bpt id=\"p1\">_</bpt>NodeName<ept id=\"p1\">_</ept>.mof in the new directory, where <bpt id=\"p2\">_</bpt>NodeName<ept id=\"p2\">_</ept> is the name of the target node of the configuration.","pos":[2896,3015],"source":"A file named _NodeName_.mof in the new directory, where _NodeName_ is the name of the target node of the configuration."},{"content":"If there are more than one nodes, a MOF file will be created for each node.","pos":[3016,3091]},{"content":"<bpt id=\"p1\">__</bpt>Note<ept id=\"p1\">__</ept>: The MOF file contains all of the configuration information for the target node.","pos":[3094,3183],"source":"__Note__: The MOF file contains all of the configuration information for the target node."},{"content":"Because of this, it’s important to keep it secure.","pos":[3184,3234]},{"content":"For more information, see <bpt id=\"p1\">[</bpt>Securing the MOF file<ept id=\"p1\">](secureMOF.md)</ept>.","pos":[3235,3299],"source":" For more information, see [Securing the MOF file](secureMOF.md)."},{"content":"Compiling the first configuration above results in the following folder structure:","pos":[3301,3383]},{"content":"If the configuration takes a parameter, as in the second example, that has to be provided at compile time.","pos":[3985,4091]},{"content":"Here's how that would look:","pos":[4092,4119]},{"content":"Using DependsOn","pos":[4757,4772]},{"content":"A useful DSC keyword is <bpt id=\"p1\">__</bpt>DependsOn<ept id=\"p1\">__</ept>.","pos":[4773,4811],"source":"A useful DSC keyword is __DependsOn__."},{"content":"Typically (though not necessarily always), DSC applies the resources in the order that they appear within the configuration.","pos":[4812,4936]},{"content":"However, <bpt id=\"p1\">__</bpt>DependsOn<ept id=\"p1\">__</ept> specifies which resources depend on other resources, and the LCM ensures that they are applied in the correct order, regardless of the order in which resource instances are defined.","pos":[4937,5141],"source":" However, __DependsOn__ specifies which resources depend on other resources, and the LCM ensures that they are applied in the correct order, regardless of the order in which resource instances are defined."},{"content":"For example, a configuration might specify that an instance of the <bpt id=\"p1\">__</bpt>User<ept id=\"p1\">__</ept> resource depends on the existence of a <bpt id=\"p2\">__</bpt>Group<ept id=\"p2\">__</ept> instance:","pos":[5142,5276],"source":" For example, a configuration might specify that an instance of the __User__ resource depends on the existence of a __Group__ instance:"},{"content":"Using New Resources in Your Configuration","pos":[5556,5597]},{"content":"If you ran the previous examples, you might have noticed that you were warned that you were using a resource without explicitly importing it.","pos":[5598,5739]},{"content":"Today, DSC ships with 12 resources as part of the PSDesiredStateConfiguration module.","pos":[5740,5825],"source":"\nToday, DSC ships with 12 resources as part of the PSDesiredStateConfiguration module."},{"content":"Other resources in external modules must be placed in <ph id=\"ph1\">`$env:PSModulePath`</ph> in order to be recognized by the LCM.","pos":[5826,5937],"source":" Other resources in external modules must be placed in `$env:PSModulePath` in order to be recognized by the LCM."},{"content":"A new cmdlet, <bpt id=\"p1\">[</bpt>Get-DscResource<ept id=\"p1\">](https://technet.microsoft.com/en-us/library/dn521625.aspx)</ept>, can be used to determine what resources are installed on the system and available for use by the LCM.","pos":[5938,6131],"source":" A new cmdlet, [Get-DscResource](https://technet.microsoft.com/en-us/library/dn521625.aspx), can be used to determine what resources are installed on the system and available for use by the LCM."},{"content":"Once these modules have been placed in <ph id=\"ph1\">`$env:PSModulePath`</ph> and are properly recognized by <bpt id=\"p1\">[</bpt>Get-DscResource<ept id=\"p1\">](https://technet.microsoft.com/en-us/library/dn521625.aspx)</ept>, they still need to be loaded within your configuration.","pos":[6132,6356],"source":" \nOnce these modules have been placed in `$env:PSModulePath` and are properly recognized by [Get-DscResource](https://technet.microsoft.com/en-us/library/dn521625.aspx), they still need to be loaded within your configuration."},{"content":"<bpt id=\"p1\">__</bpt>Import-DscResource<ept id=\"p1\">__</ept> is a dynamic keyword that can only be recognized within a <bpt id=\"p2\">__</bpt>Configuration<ept id=\"p2\">__</ept> block (i.e. it is not a cmdlet).","pos":[6357,6488],"source":"__Import-DscResource__ is a dynamic keyword that can only be recognized within a __Configuration__ block (i.e. it is not a cmdlet)."},{"content":"<bpt id=\"p1\">__</bpt>Import-DscResource<ept id=\"p1\">__</ept> supports two parameters:","pos":[6489,6536],"source":"__Import-DscResource__ supports two parameters:"},{"content":"<bpt id=\"p1\">__</bpt>ModuleName<ept id=\"p1\">__</ept> is the recommended way of using <bpt id=\"p2\">__</bpt>Import-DscResource<ept id=\"p2\">__</ept>.","pos":[6539,6609],"source":"__ModuleName__ is the recommended way of using __Import-DscResource__."},{"content":"It accepts the name of the module that contains the resources to be imported (as well as a string array of module names).","pos":[6610,6731]},{"content":"<bpt id=\"p1\">__</bpt>Name<ept id=\"p1\">__</ept> is the name of the resource to import.","pos":[6735,6782],"source":"__Name__ is the name of the resource to import."},{"content":"This is not the friendly name returned as “Name” by <bpt id=\"p1\">[</bpt>Get-DscResource<ept id=\"p1\">](https://technet.microsoft.com/en-us/library/dn521625.aspx)</ept>, but the class name used when defining the resource schema (returned as <bpt id=\"p2\">__</bpt>ResourceType<ept id=\"p2\">__</ept> by <bpt id=\"p3\">[</bpt>Get-DscResource<ept id=\"p3\">](https://technet.microsoft.com/en-us/library/dn521625.aspx)</ept>).","pos":[6783,7082],"source":" This is not the friendly name returned as “Name” by [Get-DscResource](https://technet.microsoft.com/en-us/library/dn521625.aspx), but the class name used when defining the resource schema (returned as __ResourceType__ by [Get-DscResource](https://technet.microsoft.com/en-us/library/dn521625.aspx))."},{"content":"See Also","pos":[7088,7096]},{"content":"Windows PowerShell Desired State Configuration Overview","pos":[7100,7155]},{"content":"DSC Resources","pos":[7173,7186]},{"content":"Configuring The Local Configuration Manager","pos":[7205,7248]}]}