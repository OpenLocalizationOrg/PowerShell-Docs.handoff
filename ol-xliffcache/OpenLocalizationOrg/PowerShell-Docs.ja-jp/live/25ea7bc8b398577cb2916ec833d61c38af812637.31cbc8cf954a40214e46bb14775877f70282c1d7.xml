{"content":"# Separating Configuration and Environment Data\n\n>Applies To: Windows PowerShell 4.0, Windows PowerShell 5.0\n\nIn Windows PowerShell Desired State Configuration (DSC), it is possible to separate configuration data from the logic of your configuration. Another way to look at this is to consider the structural configuration (for example, a configuration might require that IIS be installed) as separate from the environmental configuration (that is, whether the situation is a test environment vs. a production one—the node names would be different, but the configuration applied to them would be the same). This has the following advantages:\n\n* It allows you to reuse your configuration data for different resources, nodes, and configurations.\n* Configuration logic is more reusable if it does not contain hard-coded data. This is similar to good scripting guidelines for functions.\n* If some of the data needs to change, you can make the changes in one location, thereby saving time and reducing errors.\n\n## Basic concepts and examples\n\nTo specify the environmental part of the configuration, DSC uses the **ConfigurationData** parameter, which is a hash table (or it can take a .psd1 file which contains the hash table). This hash table must have at least one key **AllNodes**, which has a structured value. For example:\n\n```powershell\n$MyData = \n@{\n    AllNodes = @();\n    NonNodeData = \"\"   \n}\n```\n\nNote the AllNodes key, whose value is an array. Each element of this array is also a hash table, which requires NodeName as a key:\n\n```powershell\n$MyData = \n@{\n    AllNodes = \n    @(\n        @{\n            NodeName = \"VM-1\"\n        },\n\n \n        @{\n            NodeName = \"VM-2\"\n        },\n\n \n        @{\n            NodeName = \"VM-3\"\n        }\n    );\n\n    NonNodeData = \"\"   \n}\n```\n\nEach hash table entry in AllNodes corresponds to configuration data to a node in the configuration. In addition to the required NodeName key, you can add other keys to the hash table as well, for example:\n\n```powershell\n$MyData = \n@{\n    AllNodes = \n    @(\n        @{\n            NodeName = \"VM-1\";\n            \n        },\n\n \n        @{\n            NodeName = \"VM-2\";\n            Role     = \"SQLServer\"\n        },\n\n \n        @{\n            NodeName = \"VM-3\";\n            Role     = \"WebServer\"\n        }\n    );\n\n    NonNodeData = \"\"   \n}\n```\n\nDSC offers three special variables to use in the configuration script:\n\n* **$AllNodes**: Refers to all of the nodes. You can use filtering with **.Where()** and **.ForEach()**, so instead of hard-coding node names to select particular nodes for action, you could write something like this to select VM-1 and VM-3 in the above example:\n\n```powershell\nconfiguration MyConfiguration\n{\n    node $AllNodes.Where{$_.Role -eq \"WebServer\"}.NodeName\n    {\n    }\n}\n```\n\n* **$Node**: Once the set of nodes is filtered, you can use $Node to refer to the particular entry. For example:\n\n```powershell\nconfiguration MyConfiguration\n{\n    Import-DscResource -ModuleName xWebAdministration -Name MSFT_xWebsite\n    node $AllNodes.Where{$_.Role -eq \"WebServer\"}.NodeName\n    {\n        xWebsite Site\n        {\n            Name         = $Node.SiteName\n            PhysicalPath = $Node.SiteContents\n            Ensure       = \"Present\"\n        }\n    }\n}\n```\n\nTo apply a property to all nodes, you can set NodeName = “*”. For example, to give every node the LogPath property, you could do this:\n\n```\n$MyData = \n@{\n    AllNodes = \n    @(\n        @{\n            NodeName           = \"*\"\n            LogPath            = \"C:\\Logs\"\n        },\n\n \n        @{\n            NodeName = \"VM-1\";\n            Role     = \"WebServer\"\n            SiteContents = \"C:\\Site1\"\n            SiteName = \"Website1\"\n        },\n\n \n        @{\n            NodeName = \"VM-2\";\n            Role     = \"SQLServer\"\n        },\n\n \n        @{\n            NodeName = \"VM-3\";\n            Role     = \"WebServer\";\n            SiteContents = \"C:\\Site2\"\n            SiteName = \"Website3\"\n        }\n    );\n}\n```\n\n* **$ConfigurationData**: You can use this variable inside a configuration to access the configuration data hash table passed as a parameter. For example:\n\n```powershell\n$MyData = \n@{\n    AllNodes = \n    @(\n        @{\n            NodeName           = \"*\"\n            LogPath            = \"C:\\Logs\"\n        },\n\n \n        @{\n            NodeName = \"VM-1\";\n            Role     = \"WebServer\"\n            SiteContents = \"C:\\Site1\"\n            SiteName = \"Website1\"\n        },\n\n \n        @{\n            NodeName = \"VM-2\";\n            Role     = \"SQLServer\"\n        },\n \n\n        @{\n            NodeName = \"VM-3\";\n            Role     = \"WebServer\";\n            SiteContents = \"C:\\Site2\"\n            SiteName = \"Website3\"\n        }\n    );\n\n    NonNodeData = \n    @{\n        ConfigFileContents = (Get-Content C:\\Template\\Config.xml)\n     }   \n} \n\nconfiguration MyConfiguration\n{\n    Import-DscResource -ModuleName xWebAdministration -Name MSFT_xWebsite\n\n    node $AllNodes.Where{$_.Role -eq \"WebServer\"}.NodeName\n    {\n        xWebsite Site\n        {\n            Name         = $Node.SiteName\n            PhysicalPath = $Node.SiteContents\n            Ensure       = \"Present\"\n        }\n\n        File ConfigFile\n        {\n            DestinationPath = $Node.SiteContents + \"\\\\config.xml\"\n            Contents = $ConfigurationData.NonNodeData.ConfigFileContents\n        }\n    }\n}\n```\n\nYou can find a full example included in the [xWebAdministration module](https://powershellgallery.com/packages/xWebAdministration).","nodes":[{"content":"Separating Configuration and Environment Data","pos":[2,47]},{"content":"Applies To: Windows PowerShell 4.0, Windows PowerShell 5.0","pos":[50,108]},{"content":"In Windows PowerShell Desired State Configuration (DSC), it is possible to separate configuration data from the logic of your configuration.","pos":[110,250]},{"content":"Another way to look at this is to consider the structural configuration (for example, a configuration might require that IIS be installed) as separate from the environmental configuration (that is, whether the situation is a test environment vs. a production one—the node names would be different, but the configuration applied to them would be the same).","pos":[251,606]},{"content":"This has the following advantages:","pos":[607,641]},{"content":"It allows you to reuse your configuration data for different resources, nodes, and configurations.","pos":[645,743]},{"content":"Configuration logic is more reusable if it does not contain hard-coded data.","pos":[746,822]},{"content":"This is similar to good scripting guidelines for functions.","pos":[823,882]},{"content":"If some of the data needs to change, you can make the changes in one location, thereby saving time and reducing errors.","pos":[885,1004]},{"content":"Basic concepts and examples","pos":[1009,1036]},{"content":"To specify the environmental part of the configuration, DSC uses the <bpt id=\"p1\">**</bpt>ConfigurationData<ept id=\"p1\">**</ept> parameter, which is a hash table (or it can take a .psd1 file which contains the hash table).","pos":[1038,1222],"source":"To specify the environmental part of the configuration, DSC uses the **ConfigurationData** parameter, which is a hash table (or it can take a .psd1 file which contains the hash table)."},{"content":"This hash table must have at least one key <bpt id=\"p1\">**</bpt>AllNodes<ept id=\"p1\">**</ept>, which has a structured value.","pos":[1223,1309],"source":" This hash table must have at least one key **AllNodes**, which has a structured value."},{"content":"For example:","pos":[1310,1322]},{"content":"Note the AllNodes key, whose value is an array.","pos":[1403,1450]},{"content":"Each element of this array is also a hash table, which requires NodeName as a key:","pos":[1451,1533]},{"content":"Each hash table entry in AllNodes corresponds to configuration data to a node in the configuration.","pos":[1786,1885]},{"content":"In addition to the required NodeName key, you can add other keys to the hash table as well, for example:","pos":[1886,1990]},{"content":"DSC offers three special variables to use in the configuration script:","pos":[2329,2399]},{"content":"<bpt id=\"p1\">**</bpt>$AllNodes<ept id=\"p1\">**</ept>: Refers to all of the nodes.","pos":[2403,2445],"source":"**$AllNodes**: Refers to all of the nodes."},{"content":"You can use filtering with <bpt id=\"p1\">**</bpt>.Where()<ept id=\"p1\">**</ept> and <bpt id=\"p2\">**</bpt>.ForEach()<ept id=\"p2\">**</ept>, so instead of hard-coding node names to select particular nodes for action, you could write something like this to select VM-1 and VM-3 in the above example:","pos":[2446,2663],"source":" You can use filtering with **.Where()** and **.ForEach()**, so instead of hard-coding node names to select particular nodes for action, you could write something like this to select VM-1 and VM-3 in the above example:"},{"content":"<bpt id=\"p1\">**</bpt>$Node<ept id=\"p1\">**</ept>: Once the set of nodes is filtered, you can use $Node to refer to the particular entry.","pos":[2791,2888],"source":"**$Node**: Once the set of nodes is filtered, you can use $Node to refer to the particular entry."},{"content":"For example:","pos":[2889,2901]},{"content":"To apply a property to all nodes, you can set NodeName = “*”.","pos":[3268,3329]},{"content":"For example, to give every node the LogPath property, you could do this:","pos":[3330,3402]},{"content":"<bpt id=\"p1\">**</bpt>$ConfigurationData<ept id=\"p1\">**</ept>: You can use this variable inside a configuration to access the configuration data hash table passed as a parameter.","pos":[3980,4119],"source":"**$ConfigurationData**: You can use this variable inside a configuration to access the configuration data hash table passed as a parameter."},{"content":"For example:","pos":[4120,4132]},{"pos":[5354,5485],"content":"You can find a full example included in the <bpt id=\"p1\">[</bpt>xWebAdministration module<ept id=\"p1\">](https://powershellgallery.com/packages/xWebAdministration)</ept>.","source":"You can find a full example included in the [xWebAdministration module](https://powershellgallery.com/packages/xWebAdministration)."}]}