{"content":"# Authoring a DSC resource in C#\n\n> Applies To: Windows PowerShell 4.0, Windows PowerShell 5.0\n\nTypically, a Windows PowerShell Desired State Configuration (DSC) custom resource is implemented in a PowerShell script. However, you can also implement the functionality of a DSC custom resource by writing cmdlets in C#. For an introduction on writing cmdlets in C#, see [Writing a Windows PowerShell Cmdlet](https://technet.microsoft.com/en-us/library/dd878294.aspx).\n\nAside from implementing the resource in C# as cmdlets, the process of creating the MOF schema, creating the folder structure, importing and using your custom DSC resource are the same as described in [Writing a custom DSC resource with MOF](authoringResourceMOF.md).\n\n## Writing a cmdlet-based resource\nFor this example, we will implement a simple resource that manages a text file and its contents.\n\n### Writing the MOF schema\n\nThe following is the MOF resource definition.\n\n```\n[ClassVersion(\"1.0.0\"), FriendlyName(\"xDemoFile\")]\nclass MSFT_XDemoFile : OMI_BaseResource\n{\n                [Key, Description(\"path\")] String Path;\n                [Write, Description(\"Should the file be present\"), ValueMap{\"Present\",\"Absent\"}, Values{\"Present\",\"Absent\"}] String Ensure;\n                [Write, Description(\"Contentof file.\")] String Content;                   \n};\n```\n\n### Setting up the Visual Studio project\n#### Setting up a cmdlet project\n\n1. Open Visual Studio.\n1. Create a C# project and provide the name.\n1. Select **Class Library** from the available project templates.\n1. Click **Ok**.\n1. Add an assembly reference to System.Automation.Management.dll to your project.\n1. Change the assembly name to match the resource name. In this case, the assembly should be named **MSFT_XDemoFile**.\n\n### Writing the cmdlet code\n\nThe following C# code implements the **Get-TargetResource**, **Set-TargetResource**, and **Test-TargetResource** cmdlets.\n\n```C#\nGet-TargetResource\n       [OutputType(typeof(System.Collections.Hashtable))]\n       [Cmdlet(VerbsCommon.Get, \"TargetResource\")]\n       public class GetTargetResource : PSCmdlet\n       {\n              [Parameter(Mandatory = true)]\n              public string Path { get; set; }\n \n///<summary>\n/// Implement the logic to write the current state of the resource as a \n/// Hash table with keys being the resource properties \n/// and the Values are the corresponding current values on the target machine.\n \n///</summary>\n              protected override void ProcessRecord()\n              {\n// Download the zip file at the end of this blog to see sample implementation.\n }\n \nSet-TargetResouce\n         [OutputType(typeof(void))]\n    [Cmdlet(VerbsCommon.Set, \"TargetResource\")]\n    public class SetTargetResource : PSCmdlet\n    {\n        privatestring _ensure;\n        privatestring _content;\n        \n[Parameter(Mandatory = true)]\n        public string Path { get; set; }\n        \n[Parameter(Mandatory = false)]      \n       [ValidateSet(\"Present\", \"Absent\", IgnoreCase = true)]\n       public string Ensure {\n            get\n            {\n                // set the default to present.\n               return (this._ensure ?? \"Present\");\n            }\n            set\n            {\n                this._ensure = value;\n            }\n           } \n            public string Content {\n            get { return (string.IsNullOrEmpty(this._content) ? \"\" : this._content); }\n            set { this._content = value; }\n        }\n \n///<summary>\n        /// Implement the logic to set the state of the machine to the desired state.\n        ///</summary>\n        protected override void ProcessRecord()\n        {\n//Implement the set method of the resource \n/* Uncomment this section if your resource needs a machine reboot.\nPSVariable DscMachineStatus = new PSVariable(\"DSCMachineStatus\", 1, ScopedItemOptions.AllScope);\n                this.SessionState.PSVariable.Set(DscMachineStatus);\n*/     \n  }\n    }\nTest-TargetResource    \n       [Cmdlet(\"Test\", \"TargetResource\")]\n    [OutputType(typeof(Boolean))]\n    public class TestTargetResource : PSCmdlet\n    {   \n        \n        private string _ensure;\n        private string _content;\n \n        [Parameter(Mandatory = true)]\n        public string Path { get; set; }\n \n        [Parameter(Mandatory = false)]\n        [ValidateSet(\"Present\", \"Absent\", IgnoreCase = true)]\n        public string Ensure\n        {\n            get\n            {\n                // set the default to present.\n                return (this._ensure ?? \"Present\");\n            }\n            set\n            {\n                this._ensure = value;\n            }\n        }\n \n        [Parameter(Mandatory = false)]\n        public string Content\n        {\n            get { return (string.IsNullOrEmpty(this._content) ? \"â€œ:this._content);}\n            set { this._content = value; }\n        }\n \n///<summary>\n/// Write a Boolean value which indicates whether the current machine is in    \n/// desired state or not.\n        ///</summary>\n        protected override void ProcessRecord()\n        {\n                // Implement the test method of the resource.\n        }\n}\n```\n\n### Deploying the resource\n\nThe compiled dll file should be saved in a file structure similar to a script-based resource. The following is the folder structure for this resource.\n\n```\n$env: psmodulepath (folder)\n    |- MyDscResources (folder)\n        |- DSCResources (folder)\n            |- MSFT_XDemoFile (folder)\n                |- MSFT_XDemoFile.psd1 (file, optional)\n                |- MSFT_XDemoFile.dll (file, required)\n                |- MSFT_XDemoFile.schema.mof (file, required)\n```\n\n### See Also\n#### Concepts\n[Writing a custom DSC resource with MOF](authoringResourceMOF.md)\n#### Other Resources\n[Writing a Windows PowerShell Cmdlet](https://msdn.microsoft.com/en-us/library/dd878294.aspx)","nodes":[{"content":"Authoring a DSC resource in C#","pos":[2,32]},{"content":"Applies To: Windows PowerShell 4.0, Windows PowerShell 5.0","pos":[36,94]},{"content":"Typically, a Windows PowerShell Desired State Configuration (DSC) custom resource is implemented in a PowerShell script.","pos":[96,216]},{"content":"However, you can also implement the functionality of a DSC custom resource by writing cmdlets in C#.","pos":[217,317]},{"content":"For an introduction on writing cmdlets in C#, see <bpt id=\"p1\">[</bpt>Writing a Windows PowerShell Cmdlet<ept id=\"p1\">](https://technet.microsoft.com/en-us/library/dd878294.aspx)</ept>.","pos":[318,465],"source":" For an introduction on writing cmdlets in C#, see [Writing a Windows PowerShell Cmdlet](https://technet.microsoft.com/en-us/library/dd878294.aspx)."},{"pos":[467,733],"content":"Aside from implementing the resource in C# as cmdlets, the process of creating the MOF schema, creating the folder structure, importing and using your custom DSC resource are the same as described in <bpt id=\"p1\">[</bpt>Writing a custom DSC resource with MOF<ept id=\"p1\">](authoringResourceMOF.md)</ept>.","source":"Aside from implementing the resource in C# as cmdlets, the process of creating the MOF schema, creating the folder structure, importing and using your custom DSC resource are the same as described in [Writing a custom DSC resource with MOF](authoringResourceMOF.md)."},{"content":"Writing a cmdlet-based resource","pos":[738,769]},{"content":"For this example, we will implement a simple resource that manages a text file and its contents.","pos":[770,866]},{"content":"Writing the MOF schema","pos":[872,894]},{"content":"The following is the MOF resource definition.","pos":[896,941]},{"content":"Setting up the Visual Studio project","pos":[1339,1375]},{"content":"Setting up a cmdlet project","pos":[1381,1408]},{"content":"Open Visual Studio.","pos":[1413,1432]},{"content":"Create a C# project and provide the name.","pos":[1436,1477]},{"pos":[1481,1543],"content":"Select <bpt id=\"p1\">**</bpt>Class Library<ept id=\"p1\">**</ept> from the available project templates.","source":"Select **Class Library** from the available project templates."},{"pos":[1547,1560],"content":"Click <bpt id=\"p1\">**</bpt>Ok<ept id=\"p1\">**</ept>.","source":"Click **Ok**."},{"content":"Add an assembly reference to System.Automation.Management.dll to your project.","pos":[1564,1642]},{"content":"Change the assembly name to match the resource name.","pos":[1646,1698]},{"content":"In this case, the assembly should be named <bpt id=\"p1\">**</bpt>MSFT_XDemoFile<ept id=\"p1\">**</ept>.","pos":[1699,1761],"source":" In this case, the assembly should be named **MSFT_XDemoFile**."},{"content":"Writing the cmdlet code","pos":[1767,1790]},{"pos":[1792,1913],"content":"The following C# code implements the <bpt id=\"p1\">**</bpt>Get-TargetResource<ept id=\"p1\">**</ept>, <bpt id=\"p2\">**</bpt>Set-TargetResource<ept id=\"p2\">**</ept>, and <bpt id=\"p3\">**</bpt>Test-TargetResource<ept id=\"p3\">**</ept> cmdlets.","source":"The following C# code implements the **Get-TargetResource**, **Set-TargetResource**, and **Test-TargetResource** cmdlets."},{"content":"Deploying the resource","pos":[5104,5126]},{"content":"The compiled dll file should be saved in a file structure similar to a script-based resource.","pos":[5128,5221]},{"content":"The following is the folder structure for this resource.","pos":[5222,5278]},{"content":"See Also","pos":[5597,5605]},{"content":"Concepts","pos":[5611,5619]},{"content":"Writing a custom DSC resource with MOF","pos":[5621,5659]},{"content":"Other Resources","pos":[5691,5706]},{"content":"Writing a Windows PowerShell Cmdlet","pos":[5708,5743]}]}